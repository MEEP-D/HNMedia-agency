<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta name="vercel-toolbar" content="false">
  <meta name="x-vercel-protection-bypass" content="1">
  <meta name="x-vercel-skip-sso" content="1">

  <title>CMS - HN Media Agency</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
</head>

<body>

  <!-- ✨ CHỈ load Decap CMS – KHÔNG manual init, KHÔNG CMS.init() -->
  <script src="https://unpkg.com/decap-cms@3.0.10/dist/decap-cms.js"></script>

  <div id="nc-root"></div>

  <!-- Panel hướng dẫn -->
  <div class="cms-help" style="position: fixed; right: 16px; bottom: 16px; z-index: 9999;">
    <button id="cms-help-btn" style="background:#10B981;color:#fff;padding:10px 14px;border-radius:999px;">
      Hướng dẫn nhanh
    </button>

    <div id="cms-help-panel"
         style="display:none;position:fixed;right:16px;bottom:60px;width:320px;background:#fff;
                padding:12px;border-radius:14px;box-shadow:0 10px 30px rgba(0,0,0,0.1);">
      <button id="cms-help-close" style="float:right;">×</button>
      <h4>Quy trình chỉnh sửa</h4>
      <ol>
        <li>Sửa nội dung</li>
        <li>Bấm Save</li>
        <li>Bấm Publish</li>
      </ol>
    </div>
  </div>

  <script>
    const btn = document.getElementById('cms-help-btn');
    const panel = document.getElementById('cms-help-panel');
    const close = document.getElementById('cms-help-close');

    btn.onclick = () => panel.style.display = "block";
    close.onclick = () => panel.style.display = "none";
  </script>
<script>
  // Bắt buộc cho Decap CMS 3.x
  // window.CMS_MANUAL_INIT = false;

  if (window.CMS) {
    window.CMS.init({
      config: '/admin/config.yml'
    });
  }
</script>
  <script>
(function () {
  // 1) Lấy token từ URL
  const params = new URLSearchParams(window.location.search);
  const token = params.get("token");

  if (token) {
    console.log("Saving OAuth token:", token);

    // 2) Lưu đúng chuẩn Decap CMS
    localStorage.setItem(
      "netlify-cms-user",
      JSON.stringify({
        token,
        backendName: "github",
        loginSource: "oauth"
      })
    );

    // 3) Xóa token khỏi URL để tránh login loop
    const cleanUrl = window.location.origin + window.location.pathname;
    window.history.replaceState({}, "", cleanUrl);
  }

  // 4) Khởi động CMS
  document.addEventListener("DOMContentLoaded", () => {
    if (window.CMS) window.CMS.init();
  });
})();
</script>

</body>
</html>
